@use "utilities" as *;

.gear-map {
  --hotspot-size: #{toRem(16)};
  --hotspot-color: #{$light-color};
  --tooltip-color-bg: #{rgba($black-color, 0.8)};

  position: relative;
  width: 100%;
  height: 100%;
  overflow-x: auto;

  &:has(&__button:hover, &__button:focus) &__button {
    &:not(:hover, :focus) {
      opacity: 0;
    }
  }
  // .gear-map__container
  &__container {
    position: relative;
    height: 100%;
    margin-inline: auto;
    aspect-ratio: 1440 / 950;

    @include noise();
  }
  // .gear-map__hotspots
  &__hotspots {
    position: absolute;
    inset: 0;
  }
  // .gear-map__hotspot
  &__hotspot {
    position: absolute;
    left: var(--x);
    top: var(--y);
    translate: -50% -50%;
  }
  // .gear-map__button
  &__button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--hotspot-size);
    height: var(--hotspot-size);
    scale: 1;
    border-radius: 50%;
    background-color: rgba($dark-color, 0.4);
    border: 2px solid var(--hotspot-color);
    cursor: pointer;
    transition:
      scale 200ms,
      border-color 200ms,
      opacity 250ms ease-out calc(var(--i, 1) * 30ms);

    @include hover() {
      border-color: $accent-color;
      scale: 1.1;

      & + * {
        opacity: 1;
        filter: blur(0);
        transform: translate3d(0, 0, 0);
      }
    }

    &::before {
      content: "";
      display: block;
      width: 50%;
      height: 50%;
      border-radius: 50%;
      background-color: var(--hotspot-color);
      box-shadow: 0 0 0 0 rgba($accent-color, 0.6);
      animation: hotspot-pulse 2s ease-out calc(var(--i, 1) * 80ms) infinite;
    }
  }
  // .gear-map__tooltip
  &__tooltip {
    position: absolute;
    left: 50%;
    bottom: calc(100% + 0.8rem);
    translate: -50% 0;
    display: flex;
    flex-direction: column;
    gap: toRem(4);
    padding: toRem(8) toRem(10);
    background: var(--tooltip-color-bg);
    border-radius: 0.5rem;
    white-space: nowrap;
    opacity: 0;
    filter: blur(2px);
    pointer-events: none;
    transform: translate3d(0, 6px, 1000px);
    transition: 200ms ease-out;
    transition-property: opacity, filter, transform;

    &::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      translate: -50% 0;
      border: 6px solid transparent;
      border-top-color: var(--tooltip-color-bg);
    }
  }
  // .gear-map__tooltip-title
  &__tooltip-title {
    @extend %title-label;
    color: $white-color;
  }
}

@keyframes hotspot-pulse {
  0% {
    background-color: $accent-color;
    box-shadow: 0 0 0 0 rgba($accent-color, 1);
  }
  70% {
    box-shadow: 0 0 0 10px rgba($accent-color, 0);
  }
  100% {
    background-color: var(--hotspot-color);
    box-shadow: 0 0 0 0 rgba($accent-color, 0);
  }
}
